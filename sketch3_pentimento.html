<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
    <!--<div class="caption">pentimento — ghost versions haunting the current form</div>-->
    <h2>pentimento — ghost versions haunting the current form</h2>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    <script>
        const BLUE = [0, 0, 255];

        let t = 0;
        const layers = 6;

        function formAt(v, time) {
            let cx = width / 2,
                cy = height / 2;
            let baseR = min(width, height) * 0.17;
            let age = (layers - v) / layers;
            return {
                x: cx + sin(time * 0.3 + v * 0.7) * age * min(width, height) * 0.12,
                y: cy + cos(time * 0.2 + v * 0.5) * age * min(width, height) * 0.09,
                r: baseR + age * min(width, height) * 0.10 * sin(time * 0.15 + v),
            };
        }

        function setup() {
            createCanvas(windowWidth, windowHeight);
            textFont('monospace');
        }

        function draw() {
//            background(245, 240, 232);
            background(255);
            t += 0.006;

            for (let v = 0; v < layers; v++) {
                let {
                    x,
                    y,
                    r
                } = formAt(v, t);
                let age = (layers - v) / layers;
                let alpha = map(age, 0, 1, 200, 45);
                let weight = map(age, 0, 1, 1.6, 0.5);

                // ellipses — black
                noFill();
                stroke(0, alpha);
                strokeWeight(weight);
                ellipse(x, y, r * 2, r * 1.4);
                stroke(0, alpha * 0.4);
                strokeWeight(weight * 0.5);
                ellipse(x + age * 15, y - age * 10, r * 0.9, r * 0.63);

                // version labels — blue
                if (age > 0.25) {
                    noStroke();
                    fill(...BLUE, max(alpha, 90));
                    textSize(13);
                    textAlign(LEFT);
                    text(`// v${v + 1}`, x + r + 8, y + 4);
                }
            }

            // current — black stroke, blue label
            let cur = formAt(layers - 1, t);
            noFill();
            stroke(0, 220);
            strokeWeight(1.8);
            ellipse(cur.x, cur.y, cur.r * 2, cur.r * 1.4);

            noStroke();
            fill(...BLUE);
            textSize(13);
            textAlign(LEFT);
            text('// current', cur.x + cur.r + 8, cur.y + 4);

            // bottom note — blue
            textSize(13);
            fill(...BLUE, 180);
            text('// older marks show through — pentimento', 20, height - 18);
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
    <a class="next-btn" href="sketch2_algorithm_found_me.html">→</a>


</body></html>
